var x=Object.defineProperty;var y=(a,i,t)=>i in a?x(a,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[i]=t;var u=(a,i,t)=>y(a,typeof i!="symbol"?i+"":i,t);import{A as f,s as p,r as g,u as j,j as s,R as v}from"./styles.BAyKnI2L.js";function b(a){return{...a}}class S extends f{get isValidating(){return this.children.some(i=>i.isValidating)}get isFocused(){return this.children.some(i=>i.isFocused)}get isTouched(){return this.children.some(i=>i.isTouched)}get isDisabled(){return this.children.every(i=>i.isDisabled)}get isDirty(){return this.children.some(i=>i.isDirty)}get isValid(){const i=this.errors.length===0,t=this.children.every(e=>e.isValid);return i&&t}constructor(i={}){super(i)}setChildren(){for(const i of this.children)this.addChild(i)}addChild(i){i.setParent(this),i.inheritConfiguration(this),i.events.subscribe(t=>{this.emitter.emit({type:"child-event",payload:{event:t,control:i}})})}disable(){this.children.forEach(i=>i.disable())}enable(){this.children.forEach(i=>i.enable())}setDirty(i){this.children.forEach(t=>t.setDirty(i))}setTouched(i){this.children.forEach(t=>t.setTouched(i))}}class E extends S{constructor(t,e={}){super(e);u(this,"isSubmitted",!1);u(this,"isSubmitting",!1);u(this,"_lastValidationResult",null);this.fieldsConfig=t,this.options=e,this.setChildren(),this.bindMethods(),this.setOptions(e),this.emitter.on("updated",({payload:l})=>{var r,n;(n=(r=this.options).onUpdate)==null||n.call(r,l)})}get children(){return this.controls}get fields(){return this.fieldsConfig}get controls(){return Object.values(this.fieldsConfig)}get isLoading(){return this.isSubmitting||this.isValidating}get value(){const t={};for(const[e,l]of Object.entries(this.fieldsConfig))t[e]=l.value;return t}get lastValidationResult(){return this._lastValidationResult}setOptions(t){this.options&&p(this.options,t)||(super.setOptions(t),this.options=t)}bindMethods(){this.submit=this.submit.bind(this),this.onSubmit=this.onSubmit.bind(this),this.validate=this.validate.bind(this)}setValue(t){var r,n;const e=b(this.value);for(const[d,o]of Object.entries(t))this.fields[d].setValue(o);!p(e,this.value)&&((n=(r=this.options).onUpdate)==null||n.call(r,this.value))}async submit(){var e,l,r,n,d,o;const t=await this.validate();this.isSubmitting=!0,this.isSubmitted=!0,this.emitter.emit({type:"submit-started"});try{await Promise.all([t.success?(l=(e=this.options).onValidSubmit)==null?void 0:l.call(e,this.value):(n=(r=this.options).onInvalidSubmit)==null?void 0:n.call(r,t),(o=(d=this.options).onAnySubmit)==null?void 0:o.call(d)])}catch(h){console.error(h)}finally{this.isSubmitting=!1,this.emitter.emit({type:"submit-finished"})}}async validate(){this.setValidating(!0),this.emitter.emit({type:"validation-started"});const t=this.validateValue(this.value),e={};let l=!0;const r=Object.entries(this.fieldsConfig).map(async([h,c])=>{const m=await c.validate();m.success===!1&&(l=!1),e[h]=m}),[n]=await Promise.all([t,...r]);n.success?this.clearErrors():this.setErrors(n.errors),this.setValidating(!1);const o={success:n.success&&l,errors:n.errors,fieldErrors:e};return this._lastValidationResult=o,this.emitter.emit({type:"validation-finished",payload:o}),o}async onSubmit(t){t.preventDefault(),await this.submit()}reset(){var l,r;this.isSubmitted=!1;const t=b(this.value);this.controls.forEach(n=>n.reset()),!p(t,this.value)&&((r=(l=this.options).onUpdate)==null||r.call(l,this.value)),this.emitter.emit({type:"reset"})}getSnapshot(){return{...super.getSnapshot(),isLoading:this.isLoading,isSubmitted:this.isSubmitted,fields:this.fields,isSubmitting:this.isSubmitting,lastValidationResult:this.lastValidationResult}}}function V(a,i){const[t]=g.useState(a);return g.useEffect(()=>{i&&t.setOptions(i)},[t,i]),j(t,i)}const C=g.memo(({form:a})=>{const{isDirty:i,isFocused:t,isValid:e,isTouched:l,errors:r,isValidating:n,value:d,isSubmitting:o,api:h,isLoading:c}=V(a);return s.jsxs("div",{style:{padding:"1rem",borderTop:"1px solid black",position:"relative",marginBlockEnd:"1rem",marginTop:"50px"},children:[s.jsx("h3",{style:{margin:"0",padding:"0 5px",position:"absolute",top:"-10px",background:"white"},children:"Form state"}),s.jsxs("div",{style:{display:"flex",gap:20,alignItems:"center"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[s.jsxs("span",{children:["isDirty: ",String(i)]}),s.jsxs("span",{children:["isFocused: ",String(t)]}),s.jsxs("span",{children:["isTouched: ",String(l)]}),s.jsxs("span",{children:["isValid: ",String(e)]}),s.jsxs("span",{children:["isSubmitting: ",String(o)]}),s.jsxs("span",{children:["isValidating: ",String(n)]}),s.jsxs("span",{children:["isLoading: ",String(c)]})]}),s.jsx("div",{style:{flex:1},children:s.jsx("pre",{style:{border:"1px solid gray",padding:"1rem",fontSize:"1rem"},children:JSON.stringify(d,null,2)})})]}),s.jsxs("p",{children:["Form errors: ",JSON.stringify(r),"; ",c&&s.jsx("span",{children:"loading.."})]}),s.jsxs("div",{style:{display:"flex",gap:20},children:[s.jsx("button",{style:{padding:10,fontSize:20},type:"button",onClick:h.reset,children:"reset"}),s.jsx("button",{style:{padding:10,fontSize:20},type:"submit",disabled:c,children:"→ SUBMIT FORM ←"})]})]})});C.displayName="FormState";const k=v.memo(({data:a,description:i})=>{const{api:t,errors:e,register:l,isValid:r,isDirty:n,isTouched:d,isFocused:o,isValidating:h}=a;return s.jsxs("div",{style:{padding:"1rem",border:"1px solid black",position:"relative",marginBlockEnd:"1rem"},children:[s.jsx("h4",{style:{margin:"0",padding:"0 5px",position:"absolute",top:"-10px",background:"white"},children:"Form control"}),i&&s.jsx("p",{style:{margin:0},children:i}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[s.jsxs("div",{children:[s.jsx("input",{...l(),type:"text",style:{fontSize:"1.5rem",padding:"5px 8px",borderRadius:"0.5rem",outline:"none",marginRight:"10px",borderStyle:"solid",borderWidth:"2px",borderColor:r?o?"blue":"black":"red"}}),s.jsxs("p",{style:{marginBottom:0,maxWidth:200},children:[s.jsxs("span",{style:{marginRight:10},children:["Errors: ",JSON.stringify(e)]}),h&&s.jsx("span",{children:"validating..."})]})]}),s.jsxs("div",{style:{display:"inline-flex",flexDirection:"column",gap:5,width:200},children:[s.jsxs("span",{children:["isDirty: ",String(n)]}),s.jsxs("span",{children:["isFocused: ",String(o)]}),s.jsxs("span",{children:["isTouched: ",String(d)]}),s.jsxs("span",{children:["isValid: ",String(r)]})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10,width:"120px"},children:[s.jsx("button",{type:"button",onClick:t.focus,children:"focus"}),s.jsx("button",{type:"button",onClick:t.reset,children:"reset"}),s.jsx("button",{type:"button",onClick:t.markAllAsDirty,children:"markAsDirty"}),s.jsx("button",{type:"button",onClick:t.markAllAsTouched,children:"markAsTouched"})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10,width:"120px"},children:[s.jsx("button",{type:"button",onClick:t.validate,children:"validate"}),s.jsx("button",{type:"button",onClick:t.disable,children:"disable"}),s.jsx("button",{type:"button",onClick:t.enable,children:"enable"})]})]})]})});k.displayName="Input";export{S as A,C as F,k as I,E as a,V as u};
