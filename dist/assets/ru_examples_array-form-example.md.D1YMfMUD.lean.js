var m=Object.defineProperty;var u=(n,i,s)=>i in n?m(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s;var d=(n,i,s)=>u(n,typeof i!="symbol"?i+"":i,s);import{c as C,j as l,r as A,F as p,a as E,b as f}from"./chunks/styles.BAyKnI2L.js";import{z as c}from"./chunks/index.DXqQCM1T.js";import{A as B,u as x,I as y,F as v,a as D}from"./chunks/input.DkJVty3J.js";import{p as b,v as _,c as S,ae as w,j,o as V}from"./chunks/framework.DZiWE35w.js";class P extends B{constructor(s=[],a={}){super(a);d(this,"controls",[]);this.controls=s,this.setChildren()}get children(){return this.controls}get size(){return this.controls.length}get value(){return this.controls.map(s=>s.value)}setValue(s){this.controls.forEach((a,t)=>a.setValue(s[t]))}reset(){this.controls=[],this.emitter.emit({type:"reset"}),this.emitter.emit({type:"controls-list-updated",payload:[]})}addControl(s){this.addChild(s),this.controls.push(s),this.emitter.emit({type:"control-added",payload:s}),this.emitter.emit({type:"controls-list-updated",payload:this.controls})}removeControl(s){const a=this.controls.findIndex(t=>t===s);a!==-1&&(this.controls.splice(a,1),this.emitter.emit({type:"control-removed",payload:s}),this.emitter.emit({type:"controls-list-updated",payload:this.controls}))}removeAt(s){const[a]=this.controls.splice(s,1);a&&(this.emitter.emit({type:"control-removed",payload:a}),this.emitter.emit({type:"controls-list-updated",payload:this.controls}))}async validate(){this.setValidating(!0),this.emitter.emit({type:"validation-started"});const s=this.validateValue(this.value),a=new Array(this.size);let t=!0;const e=this.controls.map(async(g,F)=>{const o=await g.validate();o.success===!1&&(t=!1),a[F]=o}),[h]=await Promise.all([s,...e]);h.success?this.clearErrors():this.setErrors(h.errors),this.setValidating(!1);const r={success:h.success&&t,errors:h.errors,controlsErrors:a};return this.emitter.emit({type:"validation-finished",payload:r}),r}getSnapshot(){return{...super.getSnapshot(),controls:[...this.controls]}}}function z(){return new D({name:new p("name",{validators:[c.string().max(5)]}),array:new P([new p("0")])})}const G=()=>{const{api:n,fields:i,instance:s}=x(z),a=A.useCallback(()=>{const t=i.array.size.toString();i.array.addControl(new p(t,{validators:c.string().min(3)}))},[i.array]);return l.jsxs("form",{onSubmit:n.onSubmit,className:"example-form",children:[l.jsx(E,{control:i.name,children:t=>l.jsx(y,{data:t})}),l.jsx("button",{type:"button",onClick:a,children:"ADD CONTROL"}),l.jsx("hr",{}),l.jsx(f,{control:i.array,children:({controls:t})=>t.map((e,h)=>l.jsx(E,{control:e,children:k=>l.jsx(y,{data:k})},h))}),l.jsx(v,{form:s})]})};function T(n){C(n).render(l.jsx(G,{}))}const L=JSON.parse('{"title":"Форма с массивом полей","description":"","frontmatter":{},"headers":[],"relativePath":"ru/examples/array-form-example.md","filePath":"ru/examples/array-form-example.md"}'),N={name:"ru/examples/array-form-example.md"},M=Object.assign(N,{setup(n){const i=b();return _(()=>T(i.value)),(s,a)=>(V(),S("div",null,[a[0]||(a[0]=w("",14)),j("div",{ref_key:"el",ref:i},null,512)]))}});export{L as __pageData,M as default};
